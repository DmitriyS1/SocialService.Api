
# SocialService.Api - тестовое задание
#### Внутренний сервис для потенциальной социальной сети

## Архитектура
Выбрана классическая трехзвенная архитектура. Разделены Контроллеры, Сервисы с бизнес логикой и репозитории, выполняющие работу с данными.

В такой архитектуре достаточно легко отделить какой-либо слой для переработки. В отдельный проект вынесена работа с бд (это позволит безболезненно заменить базу в дальнейшем).

Слой контроллеров (SocialService.Api) зависит от слоя бизнес логики (SocialService.Management),  а бизнес логика зависит от репозиториев (SocialService.Repository).

Несмотря на небольшое переусложнение в процессе создания проектов, правильной их компоновки и т.д. Получилось достаточно гибкое решение, готовое к изменениям.

## Работа с базой данных

На всякий случай опишу.

Для работы с бд предпочитаю пользоваться EFCore. Сильно ускоряет разработку и очень удобно.

Чтобы формировать структуру бд использую EntityTypeConfiguration. Такой подход позволяет более гибко настраивать схему бд.


## Проблемы
 - **Ошибки**
 
 Считаю, что нужно добавлять собственные коды ошибок, согласованные с потребителем приложения. Кастомные классы, например: EmptyResultOrError, ResultOrError. 
 При работе с такими классами проще становится обработка ошибок и работа с сервисами или репозиториями, которые не предполагают возврата результата (например создание чего-то).
 Это, конечно, холиварный вопрос - возвращать или нет, но я обычно встречал "не возвращать".
 
 - **Исключения**
 
 При росте приложения не хватит только BusinessException. Нужно будет создать набор исключений, подходящих в конкретных ситуациях.
 
 - **Автомаппер**

Я его не добавил, потому что посчитал усложнением задания, а там сказано - делать проще, руководствуясь здравым смыслом. Но он сильно помогает в работе с маппингом.
В целом, я даже немного пожалел, что не добавил сразу.

 - **Логгирование**

Я добавил логирование в консоль и это хорошо работает при тестировании руками, но, конечно, в боевом примере нужно добавлять какое-то решение для логов.

 - **Работа с пользователем**

Кажется, что слишком много позволено потребителю апи. Несмотря на тестовость задачи, все время при работе с пользователем было ощущение, 
что нужно получать пользователя из контекста. Я думал о том, чтобы добавить логин пользователя в специальный хедер в запросе (X-User-Auth как пример).
Обработку такого хедера написать немного заморочено, но раз уж сервис внутренний, то это облегчило бы в будущем работу с пользователем.

 - **Документация**
 
 Сюда я бы отнес еще настройку отображения контрактов контроллеров для Swagger (в примере ниже). 
 ```/// <summary>
        /// Создать новый аккаунт
        /// </summary>
        /// <param name="model">Объект аккаунта с заполненными обязательными полями</param>
        /// <response code="201">Новый аккаунт успешно создан</response>
        /// <response code="400">Ошибка в одном или нескольких параметрах</response>
        /// <response code="422">Переданный параметр запроса отсутствует в базе данных</response>
        /// <response code="502">Ошибка при создании аккаунта</response>
        [HttpPost]
        [ProducesResponseType(201, Type = typeof(PostAccountResponse))]
        [ProducesResponseType(400, Type = typeof(ApiError))]
        [ProducesResponseType(422, Type = typeof(ApiError))]
        [ProducesResponseType(502, Type = typeof(ApiError))]```
        
 Я больше склоняюсь к мнению, что нужно писать документацию. Ее наличие ускоряет введение новичка в проект. 
 В целях экономии времени я не везде ее добавил, т.к. начал выбиваться из поставленных сроков. Но комменты на каждом углу - зло)
